//wrecked-no-grab=true
!function(){let t=/data:([a-zA-Z0-9!#$&.+-^_]+\/[a-zA-Z0-9!#$&.+-^_]+)?(;[a-zA-Z0-9!#$&.+-^_]+)*;base64,[A-Za-z0-9+/]+={0,2}/g,e=/^(?:(import(?:\s+\*\s+as\s+\w+|\s+\w+|\s*\{[^}]*\})\s+from\s+)["']([^"']+)["'];?)(?:\s*)(?!\/\/\s*wrecked-no-grab=true)\n/mg,a=/^[a-z][a-z\d+\-.]*:/,r=/(?<!\\)\//,n={".js":"javascript"},s="file:"==window.location.protocol,o=null,i=null,l=[];function c(t){for(let[e,a]of Object.entries(n))if(t.endsWith(e))return a;return"text"}function p(...t){let e=[];for(let a of(t[0].startsWith("/")||(t=[i].concat(t)),t))for(let n of a.split(r))""!=n&&"."!=n&&(".."==n?e.pop():e.push(n));return"/"+e.filter(t=>""!==t).join("/")}let u=fetch;async function d(t){if(void 0==t.data){if(!t.src)return!1;let e=await fetch(t.src);t.type||(t.type=e.headers.get("Content-Type")),t.data=await e.text()}return t}async function f(t){let a=t.type,r=t.data;if("javascript"==a){let n=r.matchAll(e);for(let s of n){let o=s[2];o=/^\.?\.?\//.test(o)?"_wrecked"+p(o):"https://unpkg.com/"+o+"?module",r=r.replaceAll(s[0],s[1]+'"'+o+'"; // wrecked-no-grab=true\n')}}return{type:a,data:r}}async function m(e){if(!(e=await d(e)))return;e=await f(e);let a=document.createElement("script");a.textContent=e.data,a.setAttribute("data-wrecked-no-grab","true"),a.type="importmap"==e.type?"importmap":"module",console.log("running",a.textContent.replace(t,"<data uri>")),document.body.appendChild(a)}async function y(){let t=l.slice(),a;if(s)a=Object.fromEntries(Object.keys(o).map(t=>["_wrecked"+t,t]));else for(a={};l.length>0;){let r=await d(l.pop());if(!r)return;if(r.data.matchAll(e).forEach(t=>{let e=t[2];/^\.?\.?\//.test(e)&&l.push({src:e,type:c(e)})}),r.src){let n=(/^\.?\.?\//.test(r.src)?"_wrecked":".")+p(r.src),i=await f(await d(r));a[n]="data:text/javascript;base64,"+btoa(i.data)}}for(let u of(await m({type:"importmap",data:JSON.stringify({imports:a})}),t))await m(u)}function w(t){if(t.tagName&&"SCRIPT"==t.tagName&&!t.getAttribute("data-wrecked-no-grab")){if(/^\s*\/\/[^\n]*wrecked-no-grab=true/.test(t.textContent))return;console.log(t);let e=t.getAttribute("type");e.startsWith("wrecked/")&&(e=e.slice(8)),t.setAttribute("type","text/plain"),t.parentNode.removeChild(t),t.setAttribute("data-wrecked-no-grab","true");let a=t.getAttribute("src");a&&"<anonymous code>"!==a?l.push({type:e,src:a}):l.push({type:e,data:t.textContent})}}window.fetch=async function(t){if(a.test(t)||!s){let e=await u(t);return e.headers.has("Content-Type")||e.headers.set("Content-Type",c(t)),e}{let r=o[p(t)],n="string"==typeof r?r:await r.text(),i={"Content-Type":c(t)};return new Response(n,{status:200,statusText:"OK",headers:i})}},document.querySelectorAll("script").forEach(w),new MutationObserver(function(t){for(let e of t)for(let a of e.addedNodes)w(a)}).observe(document.documentElement,{childList:!0,subtree:!0}),window.opener?(window.addEventListener("message",async function(t){let{mode:e,type:a,request:r,data:n}=t.data;"response"==e&&("filemap"==a?(o=n,null!==i&&y()):"currentpath"==a&&(i=n,null!==o&&y()))}),window.opener.postMessage({mode:"request",type:"filemap"},"*"),window.opener.postMessage({mode:"request",type:"currentpath"},"*")):(i="/",window.addEventListener("load",y)),window.require=async function(t){let e=await o[p(t)].text(),a={require:require,module:{exports:{}}};return Function(`'use strict'; ${e}`).bind(a)(),a.module.exports}}();